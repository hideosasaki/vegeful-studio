/**
 * Blinker module
 * 
 */
var b = require('/usr/local/lib/node_modules/bonescript');

module.exports = Blinker;

/**
 * 点滅LEDを表す。
 */
function Blinker() {
    this.initialize.apply(this, arguments);
}
Blinker.prototype = {
    /**
     * コンストラクタ
     * @param {String} port アナログ出力ポート eg:'P9_14'
     */
    initialize: function(port) {
        this.port = port;
        this.value = 0;
        this.isAscending = true;
        this.ledHz = 10000;
        this.timer = null;
    },
    _move: function() {
        if (this.isAscending) {
            this.value += this.value <  25 ? 1 : 5;
        } else {
            this.value -= this.value <= 25 ? 1 : 5;
        }
        if (this.value == 0 || 50 == this.value) {
            this.isAscending = !this.isAscending;
        }
    },
    start: function() {
        if (this.timer) return;
        this.timer = setInterval(
            (function() {
                b.analogWrite(this.port, this.value / 100, this.ledHz);
                this._move();
            }).bind(this),
            50
        );
    },
    stop: function() {
        clearInterval(this.timer);
        this.timer = null;
    },
    dispose: function() {
        this.stop();
        b.analogWrite(this.port, 0, this.ledHz);
    },
};

